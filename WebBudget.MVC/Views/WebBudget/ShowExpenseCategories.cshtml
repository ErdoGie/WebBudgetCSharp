@model IEnumerable<WebBudget.Domain.Entities.ExpenseCategory>

@{
	ViewData["Title"] = "ShowExpenseCategory";
	Layout = "~/Views/Shared/_Layout.cshtml";
}

@section containerContent {
	<h1>Your expense categories: </h1>

	<p>
		<a asp-action="Create">Create New</a>
	</p>
	<table class="table">
		<thead>
			<tr>
				<th>
					@Html.DisplayNameFor(model => model.CategoryName)
				</th>
				<th></th>
			</tr>
		</thead>
		<tbody>
			@foreach (var item in Model)
			{
				<tr>
					<td>
						@Html.DisplayFor(modelItem => item.CategoryName)
					</td>
					<td>
						<form asp-action="DeleteExpenseCategory" method="post">
							<input type="hidden" name="categoryId" value="@item.CategoryId" />
							<button type="submit" class="btn btn-danger" onclick="return confirm('Are you sure you want to delete this category? Every expense assigned to this Category will be deleted!')">Delete</button>
						</form>
					</td>
				</tr>
			}
		</tbody>
	</table>
}

@section Scripts {
	<script>
		document.querySelectorAll('.delete-btn').forEach(button => {
			button.addEventListener('click', function () {
				var categoryId = this.getAttribute('data-category-id');
				var confirmed = confirm('Are you sure you want to delete this category and its related incomes?');

				if (confirmed) {
					deleteCategory(categoryId);
				}
			});
		});

		function deleteCategory(categoryId) {
			fetch(`/WebBudgetController/ExpenseCategory/${categoryId}`, {
				method: 'POST', // w moim przypadku jest to POST
				headers: {
					'Content-Type': 'application/json',
					'X-Requested-With': 'XMLHttpRequest'
				}
			})
				.then(response => response.json())
				.then(data => {
					console.log(data);

					if (data.success) {
						showSuccessMessage('Category and related incomes have been deleted.');
					} else {
						showErrorMessage('An error occurred while deleting category.');
					}
				})
				.catch(error => {
					console.error('An error occurred:', error);
					showErrorMessage('An error occurred while deleting category.');
				});
		}
	</script>
}
